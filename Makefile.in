export CC=gcc
export CFLAGS=-std=c99 -pthread @{CFLAGS} -I/usr/X11/include -D_BSD_SOURCE -D_DEFAULT_SOURCE -DPREFIX=\"@{PREFIX}\" -pedantic -Werror -Wstrict-aliasing -Wchar-subscripts -Wimplicit -Wsequence-point -Wwrite-strings -Wunused-variable -Wvla -Wno-pointer-sign -Wno-parentheses -Wno-unused-result
export LDFLAGS=-pthread -L/usr/X11/lib -lm -lpng -lGL -lX11 -lxcb -lX11-xcb -lOSMesa

all:
	make -C src $@

force:
	@true

medieval: force
	make -C src medieval

editor: force
	make -C src editor

check:
	$(MAKE) -C test $@

clean:
	$(MAKE) -C test $@
	$(MAKE) -C src $@

mrproper: clean
	rm -f Makefile

install:
	# TODO the strip option should not be added in debug
	install -s src/medieval @{PREFIX}bin/
	install -d @{PREFIX}share/medieval/img/ @{PREFIX}share/medieval/worlds/
	install img/*.png @{PREFIX}share/medieval/img/
	install worlds/* -t @{PREFIX}share/medieval/worlds/
	# TODO ?fonts

uninstall:
	rm -f @{PREFIX}bin/medieval
	rm -rf @{PREFIX}share/medieval/
