export CC=gcc
export CFLAGS=-std=c99 -pthread @{CFLAGS} -fstrict-aliasing -I/usr/X11/include -D_BSD_SOURCE -D_DEFAULT_SOURCE -DPREFIX=\"@{PREFIX}\" -pedantic -Werror -Wstrict-aliasing -Wchar-subscripts -Wimplicit -Wsequence-point -Wwrite-strings -Wno-pointer-sign -Wno-parentheses
export LDFLAGS=-pthread -L/usr/X11/lib -lm -lpng -lGL -lX11 -lxcb -lX11-xcb -lOSMesa

O=main.o menu.o world.o map.o resources.o battle.o movement.o combat.o pathfinding.o interface.o interface_menu.o display.o input.o input_menu.o input_map.o input_battle.o draw.o image.o format.o json.o

all: $(O)
	$(CC) $(CFLAGS) $(LDFLAGS) $^ -o medieval

editor: image.o draw.o interface.o input.o json.o format.o editor.o
	$(CC) $(CFLAGS) $(LDFLAGS) $^ -o editor

check: clean
	$(MAKE) -C test check

clean:
	$(MAKE) -C test clean
	rm -f $(O)
	rm -f medieval editor

mrproper: clean
	rm -f Makefile

install:
	cp medieval @{PREFIX}bin/
	# TODO worlds, images, ?fonts

uninstall:
	rm -f @{PREFIX}bin/medieval
